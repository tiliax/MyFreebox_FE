{"ast":null,"code":"import { Util } from 'leaflet';\nimport featureLayerService from '../../Services/FeatureLayerService';\nimport { getUrlParams, warn, setEsriAttribution, removeEsriAttribution } from '../../Util';\nimport { FeatureGrid } from './FeatureGrid';\nimport BinarySearchIndex from 'tiny-binary-search';\nexport var FeatureManager = FeatureGrid.extend({\n  /**\r\n   * Options\r\n   */\n  options: {\n    attribution: null,\n    where: '1=1',\n    fields: ['*'],\n    from: false,\n    to: false,\n    timeField: false,\n    timeFilterMode: 'server',\n    simplifyFactor: 0,\n    precision: 6,\n    fetchAllFeatures: false\n  },\n\n  /**\r\n   * Constructor\r\n   */\n  initialize: function (options) {\n    FeatureGrid.prototype.initialize.call(this, options);\n    options = getUrlParams(options);\n    options = Util.setOptions(this, options);\n    this.service = featureLayerService(options);\n    this.service.addEventParent(this); // use case insensitive regex to look for common fieldnames used for indexing\n\n    if (this.options.fields[0] !== '*') {\n      var oidCheck = false;\n\n      for (var i = 0; i < this.options.fields.length; i++) {\n        if (this.options.fields[i].match(/^(OBJECTID|FID|OID|ID)$/i)) {\n          oidCheck = true;\n        }\n      }\n\n      if (oidCheck === false) {\n        warn('no known esriFieldTypeOID field detected in fields Array.  Please add an attribute field containing unique IDs to ensure the layer can be drawn correctly.');\n      }\n    }\n\n    if (this.options.timeField.start && this.options.timeField.end) {\n      this._startTimeIndex = new BinarySearchIndex();\n      this._endTimeIndex = new BinarySearchIndex();\n    } else if (this.options.timeField) {\n      this._timeIndex = new BinarySearchIndex();\n    }\n\n    this._cache = {};\n    this._currentSnapshot = []; // cache of what layers should be active\n\n    this._activeRequests = 0;\n  },\n\n  /**\r\n   * Layer Interface\r\n   */\n  onAdd: function (map) {\n    // include 'Powered by Esri' in map attribution\n    setEsriAttribution(map);\n    this.service.metadata(function (err, metadata) {\n      if (!err) {\n        var supportedFormats = metadata.supportedQueryFormats; // Check if someone has requested that we don't use geoJSON, even if it's available\n\n        var forceJsonFormat = false;\n\n        if (this.service.options.isModern === false || this.options.fetchAllFeatures) {\n          forceJsonFormat = true;\n        } // Unless we've been told otherwise, check to see whether service can emit GeoJSON natively\n\n\n        if (!forceJsonFormat && supportedFormats && supportedFormats.indexOf('geoJSON') !== -1) {\n          this.service.options.isModern = true;\n        }\n\n        if (metadata.objectIdField) {\n          this.service.options.idAttribute = metadata.objectIdField;\n        } // add copyright text listed in service metadata\n\n\n        if (!this.options.attribution && map.attributionControl && metadata.copyrightText) {\n          this.options.attribution = metadata.copyrightText;\n          map.attributionControl.addAttribution(this.getAttribution());\n        }\n      }\n    }, this);\n    map.on('zoomend', this._handleZoomChange, this);\n    return FeatureGrid.prototype.onAdd.call(this, map);\n  },\n  onRemove: function (map) {\n    removeEsriAttribution(map);\n    map.off('zoomend', this._handleZoomChange, this);\n    return FeatureGrid.prototype.onRemove.call(this, map);\n  },\n  getAttribution: function () {\n    return this.options.attribution;\n  },\n\n  /**\r\n   * Feature Management\r\n   */\n  createCell: function (bounds, coords) {\n    // dont fetch features outside the scale range defined for the layer\n    if (this._visibleZoom()) {\n      this._requestFeatures(bounds, coords);\n    }\n  },\n  _requestFeatures: function (bounds, coords, callback, offset) {\n    this._activeRequests++; // default param\n\n    offset = offset || 0;\n    var originalWhere = this.options.where; // our first active request fires loading\n\n    if (this._activeRequests === 1) {\n      this.fire('loading', {\n        bounds: bounds\n      }, true);\n    }\n\n    return this._buildQuery(bounds, offset).run(function (error, featureCollection, response) {\n      if (response && response.exceededTransferLimit) {\n        this.fire('drawlimitexceeded');\n      } // the where changed while this request was being run so don't it.\n\n\n      if (this.options.where !== originalWhere) {\n        return;\n      } // no error, features\n\n\n      if (!error && featureCollection && featureCollection.features.length) {\n        // schedule adding features until the next animation frame\n        Util.requestAnimFrame(Util.bind(function () {\n          this._addFeatures(featureCollection.features, coords);\n\n          this._postProcessFeatures(bounds);\n        }, this));\n      } // no error, no features\n\n\n      if (!error && featureCollection && !featureCollection.features.length) {\n        this._postProcessFeatures(bounds);\n      }\n\n      if (error) {\n        this._postProcessFeatures(bounds);\n      }\n\n      if (callback) {\n        callback.call(this, error, featureCollection);\n      }\n\n      if (response && (response.exceededTransferLimit || response.properties && response.properties.exceededTransferLimit) && this.options.fetchAllFeatures) {\n        this._requestFeatures(bounds, coords, callback, offset + featureCollection.features.length);\n      }\n    }, this);\n  },\n  _postProcessFeatures: function (bounds) {\n    // deincrement the request counter now that we have processed features\n    this._activeRequests--; // if there are no more active requests fire a load event for this view\n\n    if (this._activeRequests <= 0) {\n      this.fire('load', {\n        bounds: bounds\n      });\n    }\n  },\n  _cacheKey: function (coords) {\n    return coords.z + ':' + coords.x + ':' + coords.y;\n  },\n  _addFeatures: function (features, coords) {\n    // coords is optional - will be false if coming from addFeatures() function\n    if (coords) {\n      var key = this._cacheKey(coords);\n\n      this._cache[key] = this._cache[key] || [];\n    }\n\n    for (var i = features.length - 1; i >= 0; i--) {\n      var id = features[i].id;\n\n      if (this._currentSnapshot.indexOf(id) === -1) {\n        this._currentSnapshot.push(id);\n      }\n\n      if (typeof key !== 'undefined' && this._cache[key].indexOf(id) === -1) {\n        this._cache[key].push(id);\n      }\n    }\n\n    if (this.options.timeField) {\n      this._buildTimeIndexes(features);\n    }\n\n    this.createLayers(features);\n  },\n  _buildQuery: function (bounds, offset) {\n    var query = this.service.query().intersects(bounds).where(this.options.where).fields(this.options.fields).precision(this.options.precision);\n\n    if (this.options.fetchAllFeatures && !isNaN(parseInt(offset))) {\n      query = query.offset(offset);\n    }\n\n    query.params['resultType'] = 'tile';\n\n    if (this.options.requestParams) {\n      Util.extend(query.params, this.options.requestParams);\n    }\n\n    if (this.options.simplifyFactor) {\n      query.simplify(this._map, this.options.simplifyFactor);\n    }\n\n    if (this.options.timeFilterMode === 'server' && this.options.from && this.options.to) {\n      query.between(this.options.from, this.options.to);\n    }\n\n    return query;\n  },\n\n  /**\r\n   * Where Methods\r\n   */\n  setWhere: function (where, callback, context) {\n    this.options.where = where && where.length ? where : '1=1';\n    var oldSnapshot = [];\n    var newSnapshot = [];\n    var pendingRequests = 0;\n    var requestError = null;\n    var requestCallback = Util.bind(function (error, featureCollection) {\n      if (error) {\n        requestError = error;\n      }\n\n      if (featureCollection) {\n        for (var i = featureCollection.features.length - 1; i >= 0; i--) {\n          newSnapshot.push(featureCollection.features[i].id);\n        }\n      }\n\n      pendingRequests--;\n\n      if (pendingRequests <= 0 && this._visibleZoom() && where === this.options.where // the where is still the same so use this one\n      ) {\n        this._currentSnapshot = newSnapshot; // schedule adding features for the next animation frame\n\n        Util.requestAnimFrame(Util.bind(function () {\n          this.removeLayers(oldSnapshot);\n          this.addLayers(newSnapshot);\n\n          if (callback) {\n            callback.call(context, requestError);\n          }\n        }, this));\n      }\n    }, this);\n\n    for (var i = this._currentSnapshot.length - 1; i >= 0; i--) {\n      oldSnapshot.push(this._currentSnapshot[i]);\n    }\n\n    this._cache = {};\n\n    for (var key in this._cells) {\n      pendingRequests++;\n\n      var coords = this._keyToCellCoords(key);\n\n      var bounds = this._cellCoordsToBounds(coords);\n\n      this._requestFeatures(bounds, coords, requestCallback);\n    }\n\n    return this;\n  },\n  getWhere: function () {\n    return this.options.where;\n  },\n\n  /**\r\n   * Time Range Methods\r\n   */\n  getTimeRange: function () {\n    return [this.options.from, this.options.to];\n  },\n  setTimeRange: function (from, to, callback, context) {\n    var oldFrom = this.options.from;\n    var oldTo = this.options.to;\n    var pendingRequests = 0;\n    var requestError = null;\n    var requestCallback = Util.bind(function (error) {\n      if (error) {\n        requestError = error;\n      }\n\n      this._filterExistingFeatures(oldFrom, oldTo, from, to);\n\n      pendingRequests--;\n\n      if (callback && pendingRequests <= 0) {\n        callback.call(context, requestError);\n      }\n    }, this);\n    this.options.from = from;\n    this.options.to = to;\n\n    this._filterExistingFeatures(oldFrom, oldTo, from, to);\n\n    if (this.options.timeFilterMode === 'server') {\n      for (var key in this._cells) {\n        pendingRequests++;\n\n        var coords = this._keyToCellCoords(key);\n\n        var bounds = this._cellCoordsToBounds(coords);\n\n        this._requestFeatures(bounds, coords, requestCallback);\n      }\n    }\n\n    return this;\n  },\n  refresh: function () {\n    this.setWhere(this.options.where);\n  },\n  _filterExistingFeatures: function (oldFrom, oldTo, newFrom, newTo) {\n    var layersToRemove = oldFrom && oldTo ? this._getFeaturesInTimeRange(oldFrom, oldTo) : this._currentSnapshot;\n\n    var layersToAdd = this._getFeaturesInTimeRange(newFrom, newTo);\n\n    if (layersToAdd.indexOf) {\n      for (var i = 0; i < layersToAdd.length; i++) {\n        var shouldRemoveLayer = layersToRemove.indexOf(layersToAdd[i]);\n\n        if (shouldRemoveLayer >= 0) {\n          layersToRemove.splice(shouldRemoveLayer, 1);\n        }\n      }\n    } // schedule adding features until the next animation frame\n\n\n    Util.requestAnimFrame(Util.bind(function () {\n      this.removeLayers(layersToRemove);\n      this.addLayers(layersToAdd);\n    }, this));\n  },\n  _getFeaturesInTimeRange: function (start, end) {\n    var ids = [];\n    var search;\n\n    if (this.options.timeField.start && this.options.timeField.end) {\n      var startTimes = this._startTimeIndex.between(start, end);\n\n      var endTimes = this._endTimeIndex.between(start, end);\n\n      search = startTimes.concat(endTimes);\n    } else if (this._timeIndex) {\n      search = this._timeIndex.between(start, end);\n    } else {\n      warn('You must set timeField in the layer constructor in order to manipulate the start and end time filter.');\n      return [];\n    }\n\n    for (var i = search.length - 1; i >= 0; i--) {\n      ids.push(search[i].id);\n    }\n\n    return ids;\n  },\n  _buildTimeIndexes: function (geojson) {\n    var i;\n    var feature;\n\n    if (this.options.timeField.start && this.options.timeField.end) {\n      var startTimeEntries = [];\n      var endTimeEntries = [];\n\n      for (i = geojson.length - 1; i >= 0; i--) {\n        feature = geojson[i];\n        startTimeEntries.push({\n          id: feature.id,\n          value: new Date(feature.properties[this.options.timeField.start])\n        });\n        endTimeEntries.push({\n          id: feature.id,\n          value: new Date(feature.properties[this.options.timeField.end])\n        });\n      }\n\n      this._startTimeIndex.bulkAdd(startTimeEntries);\n\n      this._endTimeIndex.bulkAdd(endTimeEntries);\n    } else {\n      var timeEntries = [];\n\n      for (i = geojson.length - 1; i >= 0; i--) {\n        feature = geojson[i];\n        timeEntries.push({\n          id: feature.id,\n          value: new Date(feature.properties[this.options.timeField])\n        });\n      }\n\n      this._timeIndex.bulkAdd(timeEntries);\n    }\n  },\n  _featureWithinTimeRange: function (feature) {\n    if (!this.options.from || !this.options.to) {\n      return true;\n    }\n\n    var from = +this.options.from.valueOf();\n    var to = +this.options.to.valueOf();\n\n    if (typeof this.options.timeField === 'string') {\n      var date = +feature.properties[this.options.timeField];\n      return date >= from && date <= to;\n    }\n\n    if (this.options.timeField.start && this.options.timeField.end) {\n      var startDate = +feature.properties[this.options.timeField.start];\n      var endDate = +feature.properties[this.options.timeField.end];\n      return startDate >= from && startDate <= to || endDate >= from && endDate <= to || startDate <= from && endDate >= to;\n    }\n  },\n  _visibleZoom: function () {\n    // check to see whether the current zoom level of the map is within the optional limit defined for the FeatureLayer\n    if (!this._map) {\n      return false;\n    }\n\n    var zoom = this._map.getZoom();\n\n    if (zoom > this.options.maxZoom || zoom < this.options.minZoom) {\n      return false;\n    } else {\n      return true;\n    }\n  },\n  _handleZoomChange: function () {\n    if (!this._visibleZoom()) {\n      // if we have moved outside the visible zoom range clear the current snapshot, no layers should be active\n      this.removeLayers(this._currentSnapshot);\n      this._currentSnapshot = [];\n    } else {\n      /*\r\n      for every cell in this._cells\r\n        1. Get the cache key for the coords of the cell\r\n        2. If this._cache[key] exists it will be an array of feature IDs.\r\n        3. Call this.addLayers(this._cache[key]) to instruct the feature layer to add the layers back.\r\n      */\n      for (var i in this._cells) {\n        var coords = this._cells[i].coords;\n\n        var key = this._cacheKey(coords);\n\n        if (this._cache[key]) {\n          this.addLayers(this._cache[key]);\n        }\n      }\n    }\n  },\n\n  /**\r\n   * Service Methods\r\n   */\n  authenticate: function (token) {\n    this.service.authenticate(token);\n    return this;\n  },\n  metadata: function (callback, context) {\n    this.service.metadata(callback, context);\n    return this;\n  },\n  query: function () {\n    return this.service.query();\n  },\n  _getMetadata: function (callback) {\n    if (this._metadata) {\n      var error;\n      callback(error, this._metadata);\n    } else {\n      this.metadata(Util.bind(function (error, response) {\n        this._metadata = response;\n        callback(error, this._metadata);\n      }, this));\n    }\n  },\n  addFeature: function (feature, callback, context) {\n    this.addFeatures(feature, callback, context);\n  },\n  addFeatures: function (features, callback, context) {\n    this._getMetadata(Util.bind(function (error, metadata) {\n      if (error) {\n        if (callback) {\n          callback.call(this, error, null);\n        }\n\n        return;\n      } // GeoJSON featureCollection or simple feature\n\n\n      var featuresArray = features.features ? features.features : [features];\n      this.service.addFeatures(features, Util.bind(function (error, response) {\n        if (!error) {\n          for (var i = featuresArray.length - 1; i >= 0; i--) {\n            // assign ID from result to appropriate objectid field from service metadata\n            featuresArray[i].properties[metadata.objectIdField] = featuresArray.length > 1 ? response[i].objectId : response.objectId; // we also need to update the geojson id for createLayers() to function\n\n            featuresArray[i].id = featuresArray.length > 1 ? response[i].objectId : response.objectId;\n          }\n\n          this._addFeatures(featuresArray);\n        }\n\n        if (callback) {\n          callback.call(context, error, response);\n        }\n      }, this));\n    }, this));\n  },\n  updateFeature: function (feature, callback, context) {\n    this.updateFeatures(feature, callback, context);\n  },\n  updateFeatures: function (features, callback, context) {\n    // GeoJSON featureCollection or simple feature\n    var featuresArray = features.features ? features.features : [features];\n    this.service.updateFeatures(features, function (error, response) {\n      if (!error) {\n        for (var i = featuresArray.length - 1; i >= 0; i--) {\n          this.removeLayers([featuresArray[i].id], true);\n        }\n\n        this._addFeatures(featuresArray);\n      }\n\n      if (callback) {\n        callback.call(context, error, response);\n      }\n    }, this);\n  },\n  deleteFeature: function (id, callback, context) {\n    this.deleteFeatures(id, callback, context);\n  },\n  deleteFeatures: function (ids, callback, context) {\n    return this.service.deleteFeatures(ids, function (error, response) {\n      var responseArray = response.length ? response : [response];\n\n      if (!error && responseArray.length > 0) {\n        for (var i = responseArray.length - 1; i >= 0; i--) {\n          this.removeLayers([responseArray[i].objectId], true);\n        }\n      }\n\n      if (callback) {\n        callback.call(context, error, response);\n      }\n    }, this);\n  }\n});","map":{"version":3,"names":["Util","featureLayerService","getUrlParams","warn","setEsriAttribution","removeEsriAttribution","FeatureGrid","BinarySearchIndex","FeatureManager","extend","options","attribution","where","fields","from","to","timeField","timeFilterMode","simplifyFactor","precision","fetchAllFeatures","initialize","prototype","call","setOptions","service","addEventParent","oidCheck","i","length","match","start","end","_startTimeIndex","_endTimeIndex","_timeIndex","_cache","_currentSnapshot","_activeRequests","onAdd","map","metadata","err","supportedFormats","supportedQueryFormats","forceJsonFormat","isModern","indexOf","objectIdField","idAttribute","attributionControl","copyrightText","addAttribution","getAttribution","on","_handleZoomChange","onRemove","off","createCell","bounds","coords","_visibleZoom","_requestFeatures","callback","offset","originalWhere","fire","_buildQuery","run","error","featureCollection","response","exceededTransferLimit","features","requestAnimFrame","bind","_addFeatures","_postProcessFeatures","properties","_cacheKey","z","x","y","key","id","push","_buildTimeIndexes","createLayers","query","intersects","isNaN","parseInt","params","requestParams","simplify","_map","between","setWhere","context","oldSnapshot","newSnapshot","pendingRequests","requestError","requestCallback","removeLayers","addLayers","_cells","_keyToCellCoords","_cellCoordsToBounds","getWhere","getTimeRange","setTimeRange","oldFrom","oldTo","_filterExistingFeatures","refresh","newFrom","newTo","layersToRemove","_getFeaturesInTimeRange","layersToAdd","shouldRemoveLayer","splice","ids","search","startTimes","endTimes","concat","geojson","feature","startTimeEntries","endTimeEntries","value","Date","bulkAdd","timeEntries","_featureWithinTimeRange","valueOf","date","startDate","endDate","zoom","getZoom","maxZoom","minZoom","authenticate","token","_getMetadata","_metadata","addFeature","addFeatures","featuresArray","objectId","updateFeature","updateFeatures","deleteFeature","deleteFeatures","responseArray"],"sources":["C:/Users/Larix/Documents/Programmieren/ABSCHLUSS/wbs-final-box-fe/node_modules/esri-leaflet/src/Layers/FeatureLayer/FeatureManager.js"],"sourcesContent":["import { Util } from 'leaflet';\r\nimport featureLayerService from '../../Services/FeatureLayerService';\r\nimport {\r\n  getUrlParams,\r\n  warn,\r\n  setEsriAttribution,\r\n  removeEsriAttribution\r\n} from '../../Util';\r\nimport { FeatureGrid } from './FeatureGrid';\r\nimport BinarySearchIndex from 'tiny-binary-search';\r\n\r\nexport var FeatureManager = FeatureGrid.extend({\r\n  /**\r\n   * Options\r\n   */\r\n\r\n  options: {\r\n    attribution: null,\r\n    where: '1=1',\r\n    fields: ['*'],\r\n    from: false,\r\n    to: false,\r\n    timeField: false,\r\n    timeFilterMode: 'server',\r\n    simplifyFactor: 0,\r\n    precision: 6,\r\n    fetchAllFeatures: false\r\n  },\r\n\r\n  /**\r\n   * Constructor\r\n   */\r\n\r\n  initialize: function (options) {\r\n    FeatureGrid.prototype.initialize.call(this, options);\r\n\r\n    options = getUrlParams(options);\r\n    options = Util.setOptions(this, options);\r\n\r\n    this.service = featureLayerService(options);\r\n    this.service.addEventParent(this);\r\n\r\n    // use case insensitive regex to look for common fieldnames used for indexing\r\n    if (this.options.fields[0] !== '*') {\r\n      var oidCheck = false;\r\n      for (var i = 0; i < this.options.fields.length; i++) {\r\n        if (this.options.fields[i].match(/^(OBJECTID|FID|OID|ID)$/i)) {\r\n          oidCheck = true;\r\n        }\r\n      }\r\n      if (oidCheck === false) {\r\n        warn(\r\n          'no known esriFieldTypeOID field detected in fields Array.  Please add an attribute field containing unique IDs to ensure the layer can be drawn correctly.'\r\n        );\r\n      }\r\n    }\r\n\r\n    if (this.options.timeField.start && this.options.timeField.end) {\r\n      this._startTimeIndex = new BinarySearchIndex();\r\n      this._endTimeIndex = new BinarySearchIndex();\r\n    } else if (this.options.timeField) {\r\n      this._timeIndex = new BinarySearchIndex();\r\n    }\r\n\r\n    this._cache = {};\r\n    this._currentSnapshot = []; // cache of what layers should be active\r\n    this._activeRequests = 0;\r\n  },\r\n\r\n  /**\r\n   * Layer Interface\r\n   */\r\n\r\n  onAdd: function (map) {\r\n    // include 'Powered by Esri' in map attribution\r\n    setEsriAttribution(map);\r\n\r\n    this.service.metadata(function (err, metadata) {\r\n      if (!err) {\r\n        var supportedFormats = metadata.supportedQueryFormats;\r\n\r\n        // Check if someone has requested that we don't use geoJSON, even if it's available\r\n        var forceJsonFormat = false;\r\n        if (\r\n          this.service.options.isModern === false ||\r\n          this.options.fetchAllFeatures\r\n        ) {\r\n          forceJsonFormat = true;\r\n        }\r\n\r\n        // Unless we've been told otherwise, check to see whether service can emit GeoJSON natively\r\n        if (\r\n          !forceJsonFormat &&\r\n          supportedFormats &&\r\n          supportedFormats.indexOf('geoJSON') !== -1\r\n        ) {\r\n          this.service.options.isModern = true;\r\n        }\r\n\r\n        if (metadata.objectIdField) {\r\n          this.service.options.idAttribute = metadata.objectIdField;\r\n        }\r\n\r\n        // add copyright text listed in service metadata\r\n        if (\r\n          !this.options.attribution &&\r\n          map.attributionControl &&\r\n          metadata.copyrightText\r\n        ) {\r\n          this.options.attribution = metadata.copyrightText;\r\n          map.attributionControl.addAttribution(this.getAttribution());\r\n        }\r\n      }\r\n    }, this);\r\n\r\n    map.on('zoomend', this._handleZoomChange, this);\r\n\r\n    return FeatureGrid.prototype.onAdd.call(this, map);\r\n  },\r\n\r\n  onRemove: function (map) {\r\n    removeEsriAttribution(map);\r\n    map.off('zoomend', this._handleZoomChange, this);\r\n\r\n    return FeatureGrid.prototype.onRemove.call(this, map);\r\n  },\r\n\r\n  getAttribution: function () {\r\n    return this.options.attribution;\r\n  },\r\n\r\n  /**\r\n   * Feature Management\r\n   */\r\n\r\n  createCell: function (bounds, coords) {\r\n    // dont fetch features outside the scale range defined for the layer\r\n    if (this._visibleZoom()) {\r\n      this._requestFeatures(bounds, coords);\r\n    }\r\n  },\r\n\r\n  _requestFeatures: function (bounds, coords, callback, offset) {\r\n    this._activeRequests++;\r\n\r\n    // default param\r\n    offset = offset || 0;\r\n\r\n    var originalWhere = this.options.where;\r\n\r\n    // our first active request fires loading\r\n    if (this._activeRequests === 1) {\r\n      this.fire(\r\n        'loading',\r\n        {\r\n          bounds: bounds\r\n        },\r\n        true\r\n      );\r\n    }\r\n\r\n    return this._buildQuery(bounds, offset).run(function (\r\n      error,\r\n      featureCollection,\r\n      response\r\n    ) {\r\n      if (response && response.exceededTransferLimit) {\r\n        this.fire('drawlimitexceeded');\r\n      }\r\n\r\n      // the where changed while this request was being run so don't it.\r\n      if (this.options.where !== originalWhere) {\r\n        return;\r\n      }\r\n\r\n      // no error, features\r\n      if (!error && featureCollection && featureCollection.features.length) {\r\n        // schedule adding features until the next animation frame\r\n        Util.requestAnimFrame(\r\n          Util.bind(function () {\r\n            this._addFeatures(featureCollection.features, coords);\r\n            this._postProcessFeatures(bounds);\r\n          }, this)\r\n        );\r\n      }\r\n\r\n      // no error, no features\r\n      if (!error && featureCollection && !featureCollection.features.length) {\r\n        this._postProcessFeatures(bounds);\r\n      }\r\n\r\n      if (error) {\r\n        this._postProcessFeatures(bounds);\r\n      }\r\n\r\n      if (callback) {\r\n        callback.call(this, error, featureCollection);\r\n      }\r\n      if (\r\n        response &&\r\n        (response.exceededTransferLimit ||\r\n          (response.properties && response.properties.exceededTransferLimit)) &&\r\n        this.options.fetchAllFeatures\r\n      ) {\r\n        this._requestFeatures(\r\n          bounds,\r\n          coords,\r\n          callback,\r\n          offset + featureCollection.features.length\r\n        );\r\n      }\r\n    },\r\n    this);\r\n  },\r\n\r\n  _postProcessFeatures: function (bounds) {\r\n    // deincrement the request counter now that we have processed features\r\n    this._activeRequests--;\r\n\r\n    // if there are no more active requests fire a load event for this view\r\n    if (this._activeRequests <= 0) {\r\n      this.fire('load', {\r\n        bounds: bounds\r\n      });\r\n    }\r\n  },\r\n\r\n  _cacheKey: function (coords) {\r\n    return coords.z + ':' + coords.x + ':' + coords.y;\r\n  },\r\n\r\n  _addFeatures: function (features, coords) {\r\n    // coords is optional - will be false if coming from addFeatures() function\r\n    if (coords) {\r\n      var key = this._cacheKey(coords);\r\n      this._cache[key] = this._cache[key] || [];\r\n    }\r\n\r\n    for (var i = features.length - 1; i >= 0; i--) {\r\n      var id = features[i].id;\r\n\r\n      if (this._currentSnapshot.indexOf(id) === -1) {\r\n        this._currentSnapshot.push(id);\r\n      }\r\n      if (typeof key !== 'undefined' && this._cache[key].indexOf(id) === -1) {\r\n        this._cache[key].push(id);\r\n      }\r\n    }\r\n\r\n    if (this.options.timeField) {\r\n      this._buildTimeIndexes(features);\r\n    }\r\n\r\n    this.createLayers(features);\r\n  },\r\n\r\n  _buildQuery: function (bounds, offset) {\r\n    var query = this.service\r\n      .query()\r\n      .intersects(bounds)\r\n      .where(this.options.where)\r\n      .fields(this.options.fields)\r\n      .precision(this.options.precision);\r\n\r\n    if (this.options.fetchAllFeatures && !isNaN(parseInt(offset))) {\r\n      query = query.offset(offset);\r\n    }\r\n\r\n    query.params['resultType'] = 'tile';\r\n\r\n    if (this.options.requestParams) {\r\n      Util.extend(query.params, this.options.requestParams);\r\n    }\r\n\r\n    if (this.options.simplifyFactor) {\r\n      query.simplify(this._map, this.options.simplifyFactor);\r\n    }\r\n\r\n    if (\r\n      this.options.timeFilterMode === 'server' &&\r\n      this.options.from &&\r\n      this.options.to\r\n    ) {\r\n      query.between(this.options.from, this.options.to);\r\n    }\r\n\r\n    return query;\r\n  },\r\n\r\n  /**\r\n   * Where Methods\r\n   */\r\n\r\n  setWhere: function (where, callback, context) {\r\n    this.options.where = where && where.length ? where : '1=1';\r\n\r\n    var oldSnapshot = [];\r\n    var newSnapshot = [];\r\n    var pendingRequests = 0;\r\n    var requestError = null;\r\n    var requestCallback = Util.bind(function (error, featureCollection) {\r\n      if (error) {\r\n        requestError = error;\r\n      }\r\n\r\n      if (featureCollection) {\r\n        for (var i = featureCollection.features.length - 1; i >= 0; i--) {\r\n          newSnapshot.push(featureCollection.features[i].id);\r\n        }\r\n      }\r\n\r\n      pendingRequests--;\r\n\r\n      if (\r\n        pendingRequests <= 0 &&\r\n        this._visibleZoom() &&\r\n        where === this.options.where // the where is still the same so use this one\r\n      ) {\r\n        this._currentSnapshot = newSnapshot;\r\n        // schedule adding features for the next animation frame\r\n        Util.requestAnimFrame(\r\n          Util.bind(function () {\r\n            this.removeLayers(oldSnapshot);\r\n            this.addLayers(newSnapshot);\r\n            if (callback) {\r\n              callback.call(context, requestError);\r\n            }\r\n          }, this)\r\n        );\r\n      }\r\n    }, this);\r\n\r\n    for (var i = this._currentSnapshot.length - 1; i >= 0; i--) {\r\n      oldSnapshot.push(this._currentSnapshot[i]);\r\n    }\r\n\r\n    this._cache = {};\r\n\r\n    for (var key in this._cells) {\r\n      pendingRequests++;\r\n      var coords = this._keyToCellCoords(key);\r\n      var bounds = this._cellCoordsToBounds(coords);\r\n      this._requestFeatures(bounds, coords, requestCallback);\r\n    }\r\n\r\n    return this;\r\n  },\r\n\r\n  getWhere: function () {\r\n    return this.options.where;\r\n  },\r\n\r\n  /**\r\n   * Time Range Methods\r\n   */\r\n\r\n  getTimeRange: function () {\r\n    return [this.options.from, this.options.to];\r\n  },\r\n\r\n  setTimeRange: function (from, to, callback, context) {\r\n    var oldFrom = this.options.from;\r\n    var oldTo = this.options.to;\r\n    var pendingRequests = 0;\r\n    var requestError = null;\r\n    var requestCallback = Util.bind(function (error) {\r\n      if (error) {\r\n        requestError = error;\r\n      }\r\n      this._filterExistingFeatures(oldFrom, oldTo, from, to);\r\n\r\n      pendingRequests--;\r\n\r\n      if (callback && pendingRequests <= 0) {\r\n        callback.call(context, requestError);\r\n      }\r\n    }, this);\r\n\r\n    this.options.from = from;\r\n    this.options.to = to;\r\n\r\n    this._filterExistingFeatures(oldFrom, oldTo, from, to);\r\n\r\n    if (this.options.timeFilterMode === 'server') {\r\n      for (var key in this._cells) {\r\n        pendingRequests++;\r\n        var coords = this._keyToCellCoords(key);\r\n        var bounds = this._cellCoordsToBounds(coords);\r\n        this._requestFeatures(bounds, coords, requestCallback);\r\n      }\r\n    }\r\n\r\n    return this;\r\n  },\r\n\r\n  refresh: function () {\r\n    this.setWhere(this.options.where);\r\n  },\r\n\r\n  _filterExistingFeatures: function (oldFrom, oldTo, newFrom, newTo) {\r\n    var layersToRemove =\r\n      oldFrom && oldTo\r\n        ? this._getFeaturesInTimeRange(oldFrom, oldTo)\r\n        : this._currentSnapshot;\r\n    var layersToAdd = this._getFeaturesInTimeRange(newFrom, newTo);\r\n\r\n    if (layersToAdd.indexOf) {\r\n      for (var i = 0; i < layersToAdd.length; i++) {\r\n        var shouldRemoveLayer = layersToRemove.indexOf(layersToAdd[i]);\r\n        if (shouldRemoveLayer >= 0) {\r\n          layersToRemove.splice(shouldRemoveLayer, 1);\r\n        }\r\n      }\r\n    }\r\n\r\n    // schedule adding features until the next animation frame\r\n    Util.requestAnimFrame(\r\n      Util.bind(function () {\r\n        this.removeLayers(layersToRemove);\r\n        this.addLayers(layersToAdd);\r\n      }, this)\r\n    );\r\n  },\r\n\r\n  _getFeaturesInTimeRange: function (start, end) {\r\n    var ids = [];\r\n    var search;\r\n\r\n    if (this.options.timeField.start && this.options.timeField.end) {\r\n      var startTimes = this._startTimeIndex.between(start, end);\r\n      var endTimes = this._endTimeIndex.between(start, end);\r\n      search = startTimes.concat(endTimes);\r\n    } else if (this._timeIndex) {\r\n      search = this._timeIndex.between(start, end);\r\n    } else {\r\n      warn(\r\n        'You must set timeField in the layer constructor in order to manipulate the start and end time filter.'\r\n      );\r\n      return [];\r\n    }\r\n\r\n    for (var i = search.length - 1; i >= 0; i--) {\r\n      ids.push(search[i].id);\r\n    }\r\n\r\n    return ids;\r\n  },\r\n\r\n  _buildTimeIndexes: function (geojson) {\r\n    var i;\r\n    var feature;\r\n    if (this.options.timeField.start && this.options.timeField.end) {\r\n      var startTimeEntries = [];\r\n      var endTimeEntries = [];\r\n      for (i = geojson.length - 1; i >= 0; i--) {\r\n        feature = geojson[i];\r\n        startTimeEntries.push({\r\n          id: feature.id,\r\n          value: new Date(feature.properties[this.options.timeField.start])\r\n        });\r\n        endTimeEntries.push({\r\n          id: feature.id,\r\n          value: new Date(feature.properties[this.options.timeField.end])\r\n        });\r\n      }\r\n      this._startTimeIndex.bulkAdd(startTimeEntries);\r\n      this._endTimeIndex.bulkAdd(endTimeEntries);\r\n    } else {\r\n      var timeEntries = [];\r\n      for (i = geojson.length - 1; i >= 0; i--) {\r\n        feature = geojson[i];\r\n        timeEntries.push({\r\n          id: feature.id,\r\n          value: new Date(feature.properties[this.options.timeField])\r\n        });\r\n      }\r\n\r\n      this._timeIndex.bulkAdd(timeEntries);\r\n    }\r\n  },\r\n\r\n  _featureWithinTimeRange: function (feature) {\r\n    if (!this.options.from || !this.options.to) {\r\n      return true;\r\n    }\r\n\r\n    var from = +this.options.from.valueOf();\r\n    var to = +this.options.to.valueOf();\r\n\r\n    if (typeof this.options.timeField === 'string') {\r\n      var date = +feature.properties[this.options.timeField];\r\n      return date >= from && date <= to;\r\n    }\r\n\r\n    if (this.options.timeField.start && this.options.timeField.end) {\r\n      var startDate = +feature.properties[this.options.timeField.start];\r\n      var endDate = +feature.properties[this.options.timeField.end];\r\n      return (\r\n        (startDate >= from && startDate <= to) ||\r\n        (endDate >= from && endDate <= to) ||\r\n        (startDate <= from && endDate >= to)\r\n      );\r\n    }\r\n  },\r\n\r\n  _visibleZoom: function () {\r\n    // check to see whether the current zoom level of the map is within the optional limit defined for the FeatureLayer\r\n    if (!this._map) {\r\n      return false;\r\n    }\r\n    var zoom = this._map.getZoom();\r\n    if (zoom > this.options.maxZoom || zoom < this.options.minZoom) {\r\n      return false;\r\n    } else {\r\n      return true;\r\n    }\r\n  },\r\n\r\n  _handleZoomChange: function () {\r\n    if (!this._visibleZoom()) {\r\n      // if we have moved outside the visible zoom range clear the current snapshot, no layers should be active\r\n      this.removeLayers(this._currentSnapshot);\r\n      this._currentSnapshot = [];\r\n    } else {\r\n      /*\r\n      for every cell in this._cells\r\n        1. Get the cache key for the coords of the cell\r\n        2. If this._cache[key] exists it will be an array of feature IDs.\r\n        3. Call this.addLayers(this._cache[key]) to instruct the feature layer to add the layers back.\r\n      */\r\n      for (var i in this._cells) {\r\n        var coords = this._cells[i].coords;\r\n        var key = this._cacheKey(coords);\r\n        if (this._cache[key]) {\r\n          this.addLayers(this._cache[key]);\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Service Methods\r\n   */\r\n\r\n  authenticate: function (token) {\r\n    this.service.authenticate(token);\r\n    return this;\r\n  },\r\n\r\n  metadata: function (callback, context) {\r\n    this.service.metadata(callback, context);\r\n    return this;\r\n  },\r\n\r\n  query: function () {\r\n    return this.service.query();\r\n  },\r\n\r\n  _getMetadata: function (callback) {\r\n    if (this._metadata) {\r\n      var error;\r\n      callback(error, this._metadata);\r\n    } else {\r\n      this.metadata(\r\n        Util.bind(function (error, response) {\r\n          this._metadata = response;\r\n          callback(error, this._metadata);\r\n        }, this)\r\n      );\r\n    }\r\n  },\r\n\r\n  addFeature: function (feature, callback, context) {\r\n    this.addFeatures(feature, callback, context);\r\n  },\r\n\r\n  addFeatures: function (features, callback, context) {\r\n    this._getMetadata(\r\n      Util.bind(function (error, metadata) {\r\n        if (error) {\r\n          if (callback) {\r\n            callback.call(this, error, null);\r\n          }\r\n          return;\r\n        }\r\n        // GeoJSON featureCollection or simple feature\r\n        var featuresArray = features.features ? features.features : [features];\r\n\r\n        this.service.addFeatures(\r\n          features,\r\n          Util.bind(function (error, response) {\r\n            if (!error) {\r\n              for (var i = featuresArray.length - 1; i >= 0; i--) {\r\n                // assign ID from result to appropriate objectid field from service metadata\r\n                featuresArray[i].properties[metadata.objectIdField] =\r\n                  featuresArray.length > 1\r\n                    ? response[i].objectId\r\n                    : response.objectId;\r\n                // we also need to update the geojson id for createLayers() to function\r\n                featuresArray[i].id =\r\n                  featuresArray.length > 1\r\n                    ? response[i].objectId\r\n                    : response.objectId;\r\n              }\r\n              this._addFeatures(featuresArray);\r\n            }\r\n\r\n            if (callback) {\r\n              callback.call(context, error, response);\r\n            }\r\n          }, this)\r\n        );\r\n      }, this)\r\n    );\r\n  },\r\n\r\n  updateFeature: function (feature, callback, context) {\r\n    this.updateFeatures(feature, callback, context);\r\n  },\r\n\r\n  updateFeatures: function (features, callback, context) {\r\n    // GeoJSON featureCollection or simple feature\r\n    var featuresArray = features.features ? features.features : [features];\r\n    this.service.updateFeatures(\r\n      features,\r\n      function (error, response) {\r\n        if (!error) {\r\n          for (var i = featuresArray.length - 1; i >= 0; i--) {\r\n            this.removeLayers([featuresArray[i].id], true);\r\n          }\r\n          this._addFeatures(featuresArray);\r\n        }\r\n\r\n        if (callback) {\r\n          callback.call(context, error, response);\r\n        }\r\n      },\r\n      this\r\n    );\r\n  },\r\n\r\n  deleteFeature: function (id, callback, context) {\r\n    this.deleteFeatures(id, callback, context);\r\n  },\r\n\r\n  deleteFeatures: function (ids, callback, context) {\r\n    return this.service.deleteFeatures(\r\n      ids,\r\n      function (error, response) {\r\n        var responseArray = response.length ? response : [response];\r\n        if (!error && responseArray.length > 0) {\r\n          for (var i = responseArray.length - 1; i >= 0; i--) {\r\n            this.removeLayers([responseArray[i].objectId], true);\r\n          }\r\n        }\r\n        if (callback) {\r\n          callback.call(context, error, response);\r\n        }\r\n      },\r\n      this\r\n    );\r\n  }\r\n});\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}